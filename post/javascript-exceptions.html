<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
<!--[if IE]><script type="text/javascript" src="/js/html5.js"></script><![endif]-->
<meta charset="UTF-8" />
<meta name="generator" content="gvim" />
<meta name="author" content="闲耘 (hotoo.cn[AT]gmail.com)" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<!--<link rel="alternate" type="application/rss+xml" title="RSS"
  href="http://vimcn.blogspot.com/feeds/posts/default?alt=rss" />-->
<link rel="alternate" type="application/atom+xml" title="Atom" href="/atom.xml" />
<link type="text/css" rel="stylesheet" href="/css/template.css" />
<script type="text/javascript" src="/js/sea.js"></script>
<script type="text/javascript">
seajs.config({
  alias: {
    'jquery': 'jquery-1.8.3.min.js',
    'hashchange': 'jquery.ba-hashchange.min.js'
  }
});
seajs.use(["jquery", "default-main"], function(){
    alert("default")
});
</script>
<title>JavaScript 异常初步 - 闲耘™.博客</title>
</head>
<body>
<div id="wrapper">
<header>
<div style="float:right;">
    <form action="search.html" id="searchbox" onsubmit="return onSearch();">
        <input type="text" name="q" />
        <input type="submit" value="搜索" />
    </form>
</div>
<nav>
    <ul>
        <li class="first"><a href="http://hotoo.me/" title="Home">Home</a></li>
        <li class="actived"><a href="/" title="Blog">Blog</a></li>
        <li><a href="http://wiki.hotoo.me/" title="Wiki">Wiki</a></li>
        <li><a href="http://wiki.hotoo.me/Vim.html" title="Vim">Vim</a></li>
        <li><a href="http://twitter.hotoo.me/" title="Twitter">Twitter</a></li>
        <li class="last"><a href="/projects.html" title="Project">Project</a></li>
        <!-- li class="last"><a href="../resume/resume.html" title="About Me">README</a></li -->
    </ul>
</nav>
</header>
<div id="container">
  <div id="content">
        <h1>JavaScript 异常初步</h1>
    <article>
        <ul>
<li>Error, TypeError, ReferenceError</li>
<li>try/catch/finally</li>
<li>window.onerror / window.addEventListener("error")</li>
<li>on("error") events</li>
</ul>


<hr />

<p>异常处理</p>

<table>
<thead>
<tr>
<th></th>
<th> Browser   </th>
<th> message </th>
<th> description </th>
<th> line </th>
<th> number </th>
<th> lineNumber </th>
<th> name </th>
<th> fileName </th>
<th> stack </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> IE8       </td>
<td> √      </td>
<td> √          </td>
<td> ×   </td>
<td> ×     </td>
<td> ×         </td>
<td> √   </td>
<td> ×       </td>
<td> ×    |</td>
</tr>
<tr>
<td></td>
<td> Firefox 5 </td>
<td> √      </td>
<td> ×          </td>
<td> ×   </td>
<td> ×     </td>
<td> √         </td>
<td> √   </td>
<td> √       </td>
<td> √    |</td>
</tr>
<tr>
<td></td>
<td> Chrome 12 </td>
<td> √      </td>
<td> ×          </td>
<td> ×   </td>
<td> ×     </td>
<td> ×         </td>
<td> √   </td>
<td> ×       </td>
<td> √    |</td>
</tr>
<tr>
<td></td>
<td> Safari 5  </td>
<td> √      </td>
<td> ×          </td>
<td> √   </td>
<td> ×     </td>
<td> ×         </td>
<td> √   </td>
<td> ×       </td>
<td> ×    |</td>
</tr>
<tr>
<td></td>
<td> Opera 11  </td>
<td> √      </td>
<td> ×          </td>
<td> ×   </td>
<td> ×     </td>
<td> ×         </td>
<td> √   </td>
<td> ×       </td>
<td> √    |</td>
</tr>
</tbody>
</table>


<p>属性描述：</p>

<p>message:: {String} 异常消息描述，全部浏览器都支持。
name:: 错误名称，一般等同于错误类型名，如 Error, TypeError, ReferenceError...。不过实际抛出的同一个错误，不同浏览器的 name 值可能不一致(下面讲述)。
description:: 异常描述，IE 中同 message，其他浏览器不支持。
line:: 错误行号，仅 Safari 支持。
number:: 错误编号，例如“缺少对象”是 -2146823281。“xx未定义”是 -2146823279。仅 IE 支持。
lineNumber:: 错误发生所在行号，仅 Firefox 支持。
fileName:: 发生错误的所在文件地址，仅 Firefox 支持。</p>

<p>构造函数的参数&amp;顺序：</p>

<table>
<thead>
<tr>
<th></th>
<th> 参数    </th>
<th> 1(个)                     </th>
<th> 2(个)                     </th>
<th> 3(个)                                </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> Firefox </td>
<td> <code>Error(message)</code>          </td>
<td> <code>Error(message,fileName)</code> </td>
<td> <code>Error(message,fileName,lineNumber)</code> |</td>
</tr>
<tr>
<td></td>
<td> IE      </td>
<td> <code>Error(&lt;Number&gt; number)</code>  </td>
<td> <code>Error(number,message)</code>   </td>
<td> >                                    |</td>
</tr>
<tr>
<td></td>
<td> \/      </td>
<td> <code>Error(&lt;String&gt; message)</code> </td>
<td> \/                        </td>
<td> >                                    |</td>
</tr>
<tr>
<td></td>
<td> Chrome  </td>
<td> <code>Error(message)</code>          </td>
<td> >                         </td>
<td> >                                    |</td>
</tr>
<tr>
<td></td>
<td> Safari  </td>
<td> \/                        </td>
<td> >                         </td>
<td> >                                    |</td>
</tr>
<tr>
<td></td>
<td> Opera   </td>
<td> \/                        </td>
<td> >                         </td>
<td> >                                    |</td>
</tr>
</tbody>
</table>


<p>Note: IE, <code>new Error(String message)</code> - <code>&lt;Object,Array,RegExp,...&gt;.toString()</code></p>

<p>JavaScript 有多种原生异常类型，包括最常见的 Error 和 EvalError, RangeError,
ReferenceError, SyntaxError, TypeError, URIError. 这些原生异常类型分别对应的
意义是：</p>

<p>Error:: 异常的基类。
EvalError:: 发生在 eval() 函数中的异常。
RangeError:: 数值超出 JavaScript 可表示的范围。
ReferenceError:: 使用了非法的引用。
SyntaxError:: 在 eval() 中发生了语法错误的异常。除此之外的语法错误异常，均无法通过 try/catch 和 onerror 捕获，这类异常会直接报告给浏览器。
TypeError:: 变量类型不是预期的。
URIError:: 在 encodeURI() 和 decodeURI() 函数中发生异常。</p>

<p>TODO: 每种异常类型都带有以下成员/方法。
message::
line::</p>

<p>值得注意的是，直接掷出 Error 之外的其他原生异常（如 <code>throw new EvalError("msg")</code>）
时，IE 浏览器是无法捕获异常消息的，统一的异常消息是“例外被抛出且未被接住”。</p>

<p>而在 try{}catch(ex){} 中可以拿到更详细的异常信息。</p>

<p>JavaScript 也可以掷出其他类型的异常，如 throw "xx error."</p>

<h2>捕获异常</h2>

<p>推荐的异常捕获方法是 <code>try/catch</code>，不过也可以简单使用全局异常捕获方式：</p>

<pre><code>window.onerror = function(msg, file, line){
    return true;
};
</code></pre>

<p><code>window.onerror</code> 事件可以捕获浏览器端掷出的所有异常，并可以拿到错误消息，所在文件，
及错误所在行。但是无法获得异常对象本身，及触发异常的事件对象。</p>

<p>注意：onerror 事件不在早期的 HTML4 规范中，只有 IE, Firefox 和后续的 Chrome 才有
支持，Safari, Opera 至今没有支持这个事件。</p>

<p>一般来说，绑定事件(addEventListener/attachEvent)的方式比给 HTML DOM 元素直接连接事件处理函数的方式要好。</p>

<p>但是为 window 绑定 error 事件却似乎不太理想。
IE 浏览器能得到 4 个参数（比 onerror 多一个），但有效的还是前面 3 个（跟 onerror 一致）。
而其他浏览器却只能得到一个参数，即错误事件（FF 得到的是 Error，Chrome 得到的 ErrorEvent。</p>

<p>题外话，对于 HTML 元素的 onerror 事件一般会触发在加载外部资源时。</p>

<h2>无法捕获的异常</h2>

<p>如果 <code>onerror</code> 所在 <code>&lt;script&gt;</code> 块本身有语法错误，会导致 <code>onerror</code> 错误处理脚本本身无法
被执行，也就无法初始化全局异常处理函数。</p>

<p>或者异常发生在初始化全局异常处理函数之前，这个异常也无法被全局处理函数捕获。</p>

<h2>延伸阅读</h2>

<ul>
<li><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Error">Error - MDC Doc Center</a></li>
<li><a href="https://developer.mozilla.org/en/DOM/window.onerror">window.onerror - MDC Doc Center</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/cc197053%28VS.85%29.aspx">onerror Event</a></li>
<li><a href="http://www.javascriptkit.com/javatutors/error.shtml">The onerror event of the window object</a>
  <a href="http://www.javascriptkit.com/javatutors/error2.shtml">2</a>
  <a href="http://www.javascriptkit.com/javatutors/error3.shtml">3</a>
  <a href="http://www.javascriptkit.com/javatutors/error4.shtml">4</a></li>
<li><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/TypeError">TypeError</a></li>
<li><a href="http://hi.baidu.com/fcl06/blog/item/c3721bfa2643689058ee9040.html">js判断错误类型</a></li>
<li><a href="http://www.iefans.net/ie-javascript-error/">解析IE浏览器中的Javascript Error对象</a></li>
<li><a href="https://damnit.jupiterit.com/home/learn">DamnIT</a></li>
<li><a href="http://www.exceptionhub.com/">ExceptionHub</a></li>
</ul>


    </article>
    <footer class="post clearfix">
      <span class="tags">
        tags:
        
          
          <a href="/tags.html#JavaScript">JavaScript</a>
        
      </span>
      <time>April  3, 
      <a href="/archives.html#2011">2011</a>
    </footer>
    <section>
        <div id="disqus_thread"></div>
        <noscript>
        要查看或参与评论，请启用 JavaScript 支持。<br />
        Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=hotoo">comments powered by Disqus.</a>
        </noscript>
    </section>
<script type="text/javascript" src="/js/comments.js"></script>

  </div>

    <!-- Vimlike status bar -->
    <div id="status-bar">
        <span id="count"></span>
    </div>
</div>
<div id="helper-box"></div>
<div id="helper" tabindex="1">
    <table>
    <thead>
        <tr>
            <th colspan="2">Help</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th width="120">[count]gg</th>
            <td>跳转到第 [count] 行，默认第 1 行。</td>
        </tr>
        <tr>
            <th>[count]G</th>
            <td>跳转到第 [count] 行，默认最后一行。</td>
        </tr>
        <tr>
            <th>[count]j</th>
            <td>向下跳转 [count] 行，默认跳转一行。</td>
        </tr>
        <tr>
            <th>[count]k</th>
            <td>向上跳转 [count] 行，默认跳转一行。</td>
        </tr>
        <tr>
            <th>/</th>
            <td>开始搜索。按 &lt;Esc&gt; 退出。</td>
        </tr>
        <tr>
            <th>gh</th>
            <td>跳转到首页。</td>
        </tr>
        <tr>
            <th>gb</th>
            <td>跳转到博客首页。</td>
        </tr>
        <tr>
            <th>gw</th>
            <td>跳转到 Wiki 首页。</td>
        </tr>
        <tr>
            <th>gt</th>
            <td>跳转到我的 Twitter Profile 页。</td>
        </tr>
        <tr>
            <th>gp</th>
            <td>跳转到我的 Github Profile 页。</td>
        </tr>
        <tr>
            <th>?</th>
            <td>打开帮助。按 &lt;Esc&gt; 退出。</td>
        </tr>
    </tbody>
    </table>
</div>

<script type="text/javascript" src="/js/Vimlike.js"></script>
<footer>
  <p><a rel="license" href="http://creativecommons.org/licenses/by/2.5/"><img
    alt="Creative Commons License" style="border-width: 0pt;"
    src="http://i.creativecommons.org/l/by/2.5/88x31.png" align="right"/></a>
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/2.5/">Creative
    Commons Attribution 2.5 Generic License</a>.<br/>
  Copyleft &copy; 2005-2013, Power by
  <a href="http://code.google.com/p/vimwiki/">Vimwiki</a>, Theme by 闲耘™(@hotoo).
    </p>
</footer>
</div>
<script type="text/javascript">
var gaJsHost=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker=_gat._getTracker("UA-2048484-1");
pageTracker._trackPageview();
}catch(err){}</script>
</body>
</html>
