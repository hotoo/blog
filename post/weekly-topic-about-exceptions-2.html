<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.5.2">
    <meta name="theme" content="KISS 0.1">
    <title>每周异常：第 2 期 - 闲耘™.博客</title>
    <link rel="alternate" type="application/rss+xml" href="http://blog.hotoo.me/feed.xml" title="闲耘™.博客" />
    <link rel="stylesheet" href="../static/syntax.css" />
    <link type="text/css" rel="stylesheet" href="../static/template.css" />
  </head>
  <body>
  <div id="wrapper">
    <header class="navigation" role="navigation">
      <!--<a class="home" href="../">闲耘™.博客</a>-->
      <div style="float:right;">
        <form action="/search.html">
          <input type="text" name="q" autocomplete="off" />
          <input type="submit" value="搜索" />
        </form>
      </div>
      <nav class="menu">
        <ul>
          <li class="first"><a href="http://hotoo.me/"
            title="Home">Home</a></li>
          <li class=" actived"><a href="/"
            title="Blog">Blog</a></li>
          <li class=""><a href="http://wiki.hotoo.me/"
            title="Wiki">Wiki</a></li>
          <li class=""><a href="http://wiki.hotoo.me/Vim.html"
            title="Vim">Vim</a></li>
          <li class=""><a href="http://twitter.hotoo.me/"
            title="Twitter">Twitter</a></li>
          <li class="last"><a href="https://github.com/hotoo"
            title="Project">Project</a></li>
        </ul>
      </nav>
    </header>

<div id="container">
  <div id="content" class="document">
<div class="hentry">
  <h1 class="entry-title">每周异常：第 2 期</h1>
  <div class="entry-content"><p>这是全站排名第 4 的一个异常，详情如下：</p>
<table>
<thead>
<tr>
<th>KEY</th>
<th>VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>URL</td>
<td><a href="https://www.example.com/console/selectStrategy.htm">https://www.example.com/console/selectStrategy.htm</a></td>
</tr>
<tr>
<td>File</td>
<td><a href="https://a.example.com/??seajs/1.3.1/sea.js,seajs/1.3.1/plugin-combo.js,jquery/jquery/1.7.2/jquery.js">https://a.example.com/??seajs/1.3.1/sea.js,seajs/1.3.1/plugin-combo.js,jquery/jquery/1.7.2/jquery.js</a></td>
</tr>
<tr>
<td>Line</td>
<td>35</td>
</tr>
<tr>
<td>Message</td>
<td>找不到成员。<CR><CR></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Stack Trace</th>
<th>Device</th>
<th>OS</th>
<th>Browser</th>
<th>Engine</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>ie/10.0</td>
<td>trident/6.0</td>
<td>826</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>sg/2.x</td>
<td>trident/6.0</td>
<td>423</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.2</td>
<td>ie/10.0</td>
<td>trident/6.0</td>
<td>151</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>baidu/2.x</td>
<td>trident/6.0</td>
<td>27</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/3.4.5.2000</td>
<td>trident/6.0</td>
<td>10</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>tw/3.6.1.1</td>
<td>trident/6.0</td>
<td>10</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.2</td>
<td>mx/4.0.6.2000</td>
<td>trident/6.0</td>
<td>3</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>lb/undefined</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/3.5.2.1000</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/4.0.5.3000</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/4.0.5.4000</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/4.0.6.2000</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>qq/7.3.11251.400</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.2</td>
<td>tw/-1</td>
<td>trident/6.0</td>
<td>2</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>360/3.7.1.6</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>360/4.0.3.6</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>360/4.0.5.2</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/2.5.15.1000</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/2.5.16.100</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/4.0.3.6000</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/4.0.5.2000</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>mx/4.1.0.2000</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>qq/6.13.13719.201</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>qq/6.14.15493.201</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>tw/3.4.0.5</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.1</td>
<td>tw/3.6.1.0</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.2</td>
<td>mx/3.5.2.1000</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td>at function(a,b,d)</td>
<td>pc/-1</td>
<td>windows/6.2</td>
<td>mx/4.0.5.3000</td>
<td>trident/6.0</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1478</td>
</tr>
</tbody>
</table>
<hr>
<p>首先我们找到异常所在文件的第 35行，在上面的异常栈信息中我们可以知道异常从
压缩后的匿名函数 <code>function(a,b,d)</code> 中抛出，这个函数是：</p><div class="highlight"><div class="codes"><div class="code"><pre><code class="javascript">set:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b,d</span>)</span>{<span class="hljs-keyword">var</span> e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));<span class="hljs-keyword">return</span> e.nodeValue=b+<span class="hljs-string">""</span>}</code></pre></div><pre class="line"><a name="L1-1" href="#L1-1">1</a></pre></div></div><p>对应压缩前的源码是：</p><div class="highlight"><div class="codes"><div class="code"><pre><code class="javascript">    <span class="hljs-comment">// Use this for any attribute in IE6/7</span>
    <span class="hljs-comment">// This fixes almost every IE6/7 issue</span>
    nodeHook = jQuery.valHooks.button = {
        get: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> elem, name </span>) </span>{
            <span class="hljs-keyword">var</span> ret;
            ret = elem.getAttributeNode( name );
            <span class="hljs-keyword">return</span> ret &amp;&amp; ( fixSpecified[ name ] ? ret.nodeValue !== <span class="hljs-string">""</span> : ret.specified ) ?
                ret.nodeValue :
                <span class="hljs-literal">undefined</span>;
        },
        set: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> elem, value, name </span>) </span>{
            <span class="hljs-comment">// Set the existing or create a new attribute node</span>
            <span class="hljs-keyword">var</span> ret = elem.getAttributeNode( name );
            <span class="hljs-keyword">if</span> ( !ret ) {
                ret = <span class="hljs-built_in">document</span>.createAttribute( name );
                elem.setAttributeNode( ret );
            }
            <span class="hljs-keyword">return</span> ( ret.nodeValue = value + <span class="hljs-string">""</span> );
        }
    };</code></pre></div><pre class="line"><a name="L2-1" href="#L2-1">1</a>
<a name="L2-2" href="#L2-2">2</a>
<a name="L2-3" href="#L2-3">3</a>
<a name="L2-4" href="#L2-4">4</a>
<a name="L2-5" href="#L2-5">5</a>
<a name="L2-6" href="#L2-6">6</a>
<a name="L2-7" href="#L2-7">7</a>
<a name="L2-8" href="#L2-8">8</a>
<a name="L2-9" href="#L2-9">9</a>
<a name="L2-10" href="#L2-10">10</a>
<a name="L2-11" href="#L2-11">11</a>
<a name="L2-12" href="#L2-12">12</a>
<a name="L2-13" href="#L2-13">13</a>
<a name="L2-14" href="#L2-14">14</a>
<a name="L2-15" href="#L2-15">15</a>
<a name="L2-16" href="#L2-16">16</a>
<a name="L2-17" href="#L2-17">17</a>
<a name="L2-18" href="#L2-18">18</a>
<a name="L2-19" href="#L2-19">19</a>
<a name="L2-20" href="#L2-20">20</a></pre></div></div><p>这个代码是用来兼容 IE6/7 的属性操作（代码注释中号称几乎修复了 IE6/7 所有的问题），
页面中的业务源码中我们找到不少 DOM 属性的操作，其中有一些看起来几乎不会有问题，
另外一些则出现问题的可能性更高。</p>
<p>我们从这些可能性更高的部分着手，最终发现 IE10 兼容模式下会抛出『<a href="https://github.com/totorojs/javascript-exception-archives/blob/master/content/wiki/member-not-found.md">找不到成员。</a>』
的异常，这时我们注意到，异常详情中全部都是 Trident 6.0 内核的浏览器抛出的异常。
看来我们这个增加兼容模式信息的 <a href="https://github.com/totorojs/monitor.js/issues/13">Issues#13</a>
是正确的。</p>
<p>我们看到兼容模式下表单中的 Select 模拟组件显示不正常，最初以为是 Select 组件设置属性造成的异常。</p>
<p><img src="https://f.cloud.github.com/assets/143572/834321/3db467be-f2bb-11e2-93c0-007ec07ba729.png" alt="1c00b54eaad3a6f45ffec0d7526abc6e"></p>
<p>（正常情况下的 Select 模拟组件）</p>
<p><img src="https://f.cloud.github.com/assets/143572/834325/57343714-f2bb-11e2-84aa-fb8834763fce.png" alt="0aafc43da07d07423e1f67199cf5c5b9"></p>
<p>（兼容模式下的 Select 模拟组件）</p>
<p>IE10 的调试工具还是不错的，最终我们发现在设置 &quot;novalidate&quot; 属性时抛出这个异常，
想到 Validator 的相关 <a href="https://github.com/aralejs/validator/issues/30">Issues#30</a></p>
<p><img src="https://f.cloud.github.com/assets/143572/834340/6db729a6-f2bb-11e2-8558-a8f9681f99bf.png" alt="edde87186b5919bd49a4d74874c7ce36"></p>
<p>于是这个异常就破解完成。</p>
<h2 id="如何修复这个异常？">如何修复这个异常？</h2><p>找回密码的这个页面使用的 Validator@0.8.9，而 novalidate 属性造成的异常在
Validator@0.9.3 及其后续版本中得到修复。建议升级到最新版本。</p>
</div>

  <footer class="entry-meta post clearfix">
    <span class="tags"><a href="/tag">Tags</a>:
 
      <a href="/tag/#每周异常">每周异常</a>
      
    </span>

    <time datetime="2013-07-22T00:00:00.000Z">
      <a href="/2013">2013年</a>07月22日
    </time>
  </footer>
    <section>
      <div id="disqus_thread"></div>
      <noscript>
        要查看或参与评论，请启用 JavaScript 支持。<br />
        Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=hotoo">comments powered by Disqus.</a>
      </noscript>
    </section>
  <script type="text/javascript">
    
    var disqus_identifier = "weekly-topic-about-exceptions-2";
    
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://hotoo.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  </script>
</div>
</div>

    <!-- Vimlike status bar -->
    <div id="status-bar">
        <span id="count"></span>
    </div>
</div>
<div id="helper-box"></div>
<div id="helper" tabindex="1">
    <table>
    <thead>
        <tr>
            <th colspan="2">Help</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th width="120">[count]gg</th>
            <td>跳转到第 [count] 行，默认第 1 行。</td>
        </tr>
        <tr>
            <th>[count]G</th>
            <td>跳转到第 [count] 行，默认最后一行。</td>
        </tr>
        <tr>
            <th>[count]j</th>
            <td>向下跳转 [count] 行，默认跳转一行。</td>
        </tr>
        <tr>
            <th>[count]k</th>
            <td>向上跳转 [count] 行，默认跳转一行。</td>
        </tr>
        <tr>
            <th>/</th>
            <td>开始搜索。按 &lt;Esc&gt; 退出。</td>
        </tr>
        <tr>
            <th>gh</th>
            <td>跳转到首页。</td>
        </tr>
        <tr>
            <th>gb</th>
            <td>跳转到博客首页。</td>
        </tr>
        <tr>
            <th>gw</th>
            <td>跳转到 Wiki 首页。</td>
        </tr>
        <tr>
            <th>gt</th>
            <td>跳转到我的 Twitter Profile 页。</td>
        </tr>
        <tr>
            <th>gp</th>
            <td>跳转到我的 Github Profile 页。</td>
        </tr>
        <tr>
            <th>?</th>
            <td>打开帮助。按 &lt;Esc&gt; 退出。</td>
        </tr>
    </tbody>
    </table>
</div>

<script type="text/javascript" src="/static/js/Vimlike.js"></script>
<footer>
  <p><a rel="license" href="http://creativecommons.org/licenses/by/2.5/"><img
    alt="Creative Commons License" style="border-width: 0pt;"
    src="http://i.creativecommons.org/l/by/2.5/88x31.png" align="right"/></a>
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/2.5/">Creative
    Commons Attribution 2.5 Generic License</a>.<br/>
  Copyleft &copy; 2005-2013, Power by
  <a href="http://lab.lepture.com/nico/">nico@0.5.2</a>, Theme by 闲耘™(@hotoo).
  </p>
</footer>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2048484-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>